![[../../../_res/Pasted image 20240929162859.png]]

- Компиляция: исходный код на Java (`Java Source Code`) компилируется компилятором `javac` в байт-код (`Java Bytecode (.class)`).
- ClassLoader: байткод загружается в Java Virtual Machine (JVM). На этом этапе происходит загрузка классов в память
- Linking: проверяются, подключаются и разрешаются ссылки на классы и методы.
- Initialization: инициализируются статические переменные и выполняются статические блоки кода.
- Исполнение: код исполняется с помощью Interpreter, который выполняет байт-код строка за строкой. Если метод вызывается часто, то JIT Compiler компилирует его в нативный код для повышения производительности.
- Garbage Collector следит за памятью, освобождая неиспользуемые объекты и предотвращая утечки памяти.
- Взаимодействие с нативными библиотеками - Java может взаимодействовать с нативными библиотеками через Native Method Interface и Native Method Library.

Runtime Data Area

![[../../../_res/Pasted image 20241018054855.png]]

# Структура памяти Java

Память в Java состоит из следующих областей:

![[../../../_res/Pasted image 20240922142455.png]]

**Native Memory** — вся доступная системная память.

**Heap (куча)** — часть native memory, выделенная для кучи. Здесь JVM хранит объекты. Это общее пространство для всех потоков приложения. Размер этой области памяти настраивается с помощью параметра -Xms (минимальный размер) и -Xmx (максимальный размер).

**Stack (стек)** — используется для хранения локальных переменных и стека вызовов метода. Для каждого потока выделяется свой стек.

**Metaspace (метаданные)** — в этой памяти хранятся метаданные классов и статические переменные. Это пространство также является общими для всех. Так как metaspace является частью native memory, то его размер зависит от платформы. Верхний предел объема памяти, используемой для metaspace, можно настроить с помощью флага MaxMetaspaceSize.

**PermGen** (Permanent Generation, постоянное поколение) присутствовало до Java 7. Начиная с Java 8 ему на смену пришла область Metaspace.

**CodeCache (кэш кода)** — JIT-компилятор компилирует часто исполняемый код, преобразует его в нативный машинный код и кеширует для более быстрого выполнения. Это тоже часть native memory.

# Оптимизация

![[../../../_res/Pasted image 20240929162138.png]]

#### Подробнее 

- javac: Java-код (.java) компилируется с помощью компилятора `javac` в байт-код (.class).
- ClassLoader: при запуске Java-программы, `ClassLoader` загружает классы из `.class` файлов в память. Классы загружаются по мере необходимости (lazy loading).
- Interpreter: первоначально загруженный байт-код исполняется интерпретатором. Интерпретатор выполняет байт-код строка за строкой, что позволяет программе работать, даже если JIT-компиляция еще не произошла.
- Method Cache: метод кэш (method cache) используется для хранения информации о методах, которые были уже вызваны. Это позволяет избежать повторного анализа и уменьшает время выполнения при последующих вызовах.
- JIT Compiler: когда метод вызывается достаточно часто, `JIT Compiler` (Just-In-Time компилятор) берет на себя выполнение.
    - Profiler: JIT-компилятор использует профайлер для отслеживания производительности и частоты вызова методов.
    - Emitter: JIT-компилятор создает и компилирует нативный код для часто используемых методов.
- Code Cache: скомпилированный нативный код помещается в `Code Cache`, чтобы его можно было повторно использовать при следующих вызовах метода. Если метод вызывается снова, он выполняется из кэша, что значительно ускоряет выполнение программы.

# Чем различаются JRE, JVM и JDK?

![[../../../_res/Pasted image 20241026095258.png]]