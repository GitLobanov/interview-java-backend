**Fail-fast** и **fail-safe** — это два типа итераторов в Java, которые различаются по поведению при изменении коллекции во время итерации.

### **Fail-fast Итератор**

**Fail-fast** итераторы обнаруживают изменения в коллекции (например, добавление, удаление элементов) во время итерации и бросают `ConcurrentModificationException`, чтобы предупредить о том, что коллекция была изменена неправомерно. Это поведение помогает избежать потенциальных проблем, связанных с некорректной модификацией коллекции во время итерации.

Примеры коллекций, которые используют fail-fast итераторы:

- `ArrayList`
- `HashMap`

Пример использования fail-fast итератора:

java

Копировать код

![[Pasted image 20240829131339.png]]

Этот код вызовет `ConcurrentModificationException`, потому что `ArrayList` не допускает изменения своей структуры во время итерации через fail-fast итератор.

### **Fail-safe Итератор**

**Fail-safe** итераторы не бросают исключение, если коллекция изменяется во время итерации. Вместо этого они работают с копией коллекции и могут безопасно продолжать итерацию, даже если исходная коллекция была изменена. Это поведение предотвращает выброс исключений, но может привести к некорректным результатам, если коллекция изменяется.

Примеры коллекций, которые используют fail-safe итераторы:

- `ConcurrentHashMap`
- `CopyOnWriteArrayList`

Пример использования fail-safe итератора:

java

Копировать код

![[Pasted image 20240829131529.png]]

В этом случае, `ConcurrentHashMap` не бросит `ConcurrentModificationException`, поскольку использует fail-safe итератор.

### Сравнение

- **Fail-fast** итераторы: Бросают `ConcurrentModificationException` при обнаружении изменений в коллекции. Обеспечивают более безопасную и предсказуемую работу, но требуют осторожного обращения при изменении коллекции.
- **Fail-safe** итераторы: Не бросают исключения при изменении коллекции. Они работают с копией коллекции, что делает их менее чувствительными к изменениям, но может привести к несогласованности данных.

Выбор между fail-fast и fail-safe итераторами зависит от требований вашего приложения и типа коллекции, которую вы используете.