## QA

###### Что такое docker registry

Пример публичного [docker registry](https://www.baeldung.com/ops/docker-private-registry), Docker hub. Мы можем создавать свой приватный, задать аутентификацию или создать приватный аккаунт в докер хабе. A Docker registry is a system for storing and distributing Docker images with specific names. There may be several versions of the same image, each with its own set of tags.

#### Как устроены слои в Docker?

Слои создаются на каждую команду, к примеру COPY файла отдельный слой с файлом. Слои образуют образ, поэтому мы **можем кэшировать некоторые слои**, чтобы заново не собирать.

![](Pasted%20image%2020250313092206.png)

#### Какие основные инструкции используются в Dockerfile?

- `FROM <image>:<tag>` задает **базовый образ** для последующих инструкций. Dockerfile обязательно должен иметь инструкцию FROM. Можно использовать любой работающий образ, проще всего начать с загрузки образа из публичного репозитория.
- FROM AS (много-этапные сборки). Каждая инструкция FROM может использовать индивидуальный базовый образ и каждая из них начинает новую стадию сборки docker образа.

```
FROM golang:latest as build COPY . . 
RUN go build ./src/main.go 
FROM alpine:latest as production 
COPY --from=build /go/main .
```

- MAINTAINER - позволяет указать автора образа.
- RUN - выполняет любые команды в новом слое поверх текущего образа и делает коммит результата. Во время выполнения `docker build`
- LABEL - добавляет метаданные для образа. . Например, сведения о том, кто создал и поддерживает образ. **Каждая инструкция LABEL создает новый слой**, а большое количество слоев может негативно сказаться на скорости запуска образа.
- CMD - может быть использована только один раз в Dockerfile. Если вы используете больше одной CMD, то только последняя инструкция будет работать. **Основное предназначение CMD передача параметров по умолчанию для запуска контейнера.** Эти значения по умолчанию могут включать в себя исполняемый файл.
- EXPOSE - указывает Docker что контейнер слушает определенные порты после запуска. **EXPOSE не делает порты контейнера доступными для хоста.**
- ENV -  задает переменные окружения с именем `<key> и значением <value>`. Это значение будет находиться в окружении всех команд потомков Dockerfile и могут быть использованы как обычные переменные окружения.
- ADD - `ADD <src>... <dest>`  копирует новые файлы, папки. Распаковать архив автоматически. Скачать файл по URL и добавить его в образ.
- COPY - `COPY <src>... <dest>` копирует новые файлы или каталоги из src и добавляет их в файловую систему контейнера в dest.
- ENTRYPOINT - во время выполнения `docker run`. ENTRYPOINT ["curl"]. При запуске контейнера (`docker run <image> http://example.com`) выполнится команда `curl http://example.com`.

#### В чем разница между CMD и ENTRYPOINT

```dockerfile
ENTRYPOINT ["echo"] # если передать агрумент, перепоределит cmd
CMD ["Hello, World"] # по умолчанию
```

- Если запустить контейнер без аргументов, будет выполнено: `echo Hello, World`.
- Если передать аргументы: `docker run <image> Hi`, будет выполнено: `echo Hi`.
#### В чем разница между CMD и RUN в Dockerfile?

**Когда использовать `RUN`?**
- Для установки пакетов (например, `apt-get`, `yum`, `pip`). Для выполнения любых команд, которые должны быть выполнены во время сборки образа.

**Когда использовать `CMD`?**
- Для определения команды по умолчанию, которая будет выполнена при запуске контейнера. Для передачи аргументов по умолчанию в `ENTRYPOINT`.

```dockerfile
FROM ubuntu:latest
RUN apt-get update && apt-get install -y python3
COPY app.py /app/
CMD ["python3", "/app/app.py"]

- Во время сборки (`docker build`):
    - Выполняется `RUN` для установки `python3`.
    - Копируется файл `app.py` в образ.
- При запуске контейнера (`docker run <image>`):
    - Выполняется команда по умолчанию: `python3 /app/app.py`.
```

###### Какие существуют типы сетей в Docker?

В Docker есть несколько типов сетей:

1. bridge (мостовая сеть): Docker создаёт мостовую сеть по умолчанию для каждого контейнера. Контейнеры на одной мостовой сети могут общаться друг с другом напрямую.
2. host: В этой сети контейнер использует сетевые интерфейсы хоста напрямую, минуя виртуализацию сетевых интерфейсов Docker. Это может повысить производительность, но снижает изоляцию.
3. none: В контейнере отключены все сетевые интерфейсы. Контейнер полностью изолирован от сети.
4. overlay:  Эта сеть позволяет контейнерам на разных Docker-хостах общаться друг с другом, например, в кластере Docker Swarm. Она строится поверх существующих сетей.
5. macvlan:  Контейнеру назначается собственный MAC-адрес и IP, позволяя ему действовать как полноценное сетевое устройство в сети хоста.

###### Bit mount vs volumes


## Resources

- [Шпаргалка по Dockerfile](https://devops.org.ru/dockerfile-summary#d7)
- [Стройные контейнеры: как уменьшить Docker-образ с помощью многоэтапной сборки](https://proglib.io/p/stroynye-konteynery-kak-umenshit-docker-obraz-s-pomoshchyu-mnogoetapnoy-sborki-2024-11-13)