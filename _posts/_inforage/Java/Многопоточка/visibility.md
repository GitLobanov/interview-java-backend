проблема видимости возникает из-за того, что не всегда один поток видит актуальные изменения, сделанные другим потоком.