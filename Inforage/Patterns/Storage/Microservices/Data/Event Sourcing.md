![[Pasted image 20241216125813.png]]

> Все изменения состояния системы сохраняются в виде событий, а не в виде текущего состояния объекта или сущности. Являются неизменяемыми. История всех изменений, в последовательности выполнения, таким образом можно воссоздать. **Однако** дополнительная обработка данных, управление последовательностью, не обеспечивается защита от неправильных данных.

Приложения с микросервисной архитектурой часто используют асинхронные методы связи: сообщения или события. Для обеспечения атомарности операций в таких системах рекомендуется применять шаблон Event Sourcing.

В традиционных базах данных объект с текущим состоянием сохраняется напрямую. При использовании шаблона Event Sourcing вместо объектов сохраняются события, изменяющие их состояния. Итоговое состояние объекта можно получить путем повторной обработки серии событий, пришедших за определенное время. Различные службы могут воспроизводить события из хранилища событий, чтобы вычислить соответствующее состояние своих хранилищ данных. Для реализации хранилища событий обычно применяется шаблон CQRS.

Паттерн рекомендуется использовать в высокомасштабируемых транзакционных системах, управляемых событиями. Он не подходит для простых приложений, где микросервисы могут синхронно обмениваться данными (например, через API).

![[Pasted image 20241215095936.png]]


![[Pasted image 20240930141628.png]]

- В высоконагруженных системах с микросервисной архитектурой часто используются асинхронные сообщения, для нотификации сервисов при модификации сущностей.
- Возникает проблема: если отправлять среди транзакции - она может откатиться после отправки. Если после транзакции - продюсер/брокере может сломаться и не отправить данные.
- Иногда, все еще усложняется тем, что нам важна последовательность транзакций. И, если T1 выполнилась раньше T2, то Е1 должна прийти до Е2.
- Идея состоит в том, чтобы хранить не финальное состояние, а историю сообщений, обрабатывая которые, можно получить текущее состояние объекта в любой момент.

![[Pasted image 20241009135224.png]]


- Плюсы:
	- Позволяет добиться атомарности и согласованности данных
	- Поскольку у нас хранятся эвенты, мы их можем аудировать
	- Появляется историчность
- Минусы:
	- сложная архитектура
	- слишком сложный для простых приложений

# Ресурсы

-  [Drawing Boxes](https://www.youtube.com/@drawingboxes) [Event Sourcing Explained](https://www.youtube.com/watch?v=yFjzGRb8NOk)
- [Введение в CQRS + Event Sourcing: Часть 1. Основы](https://habr.com/ru/articles/146429/)
- 